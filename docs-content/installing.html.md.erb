---
title: Installing and Configuring SMB Volume Service for PCF
owner: Partners
---

This topic describes how to install and configure `SMB Volume Service for PCF`.

##<a id='install'></a> Install and Configure `SMB Volume Service for PCF`

1. Download the product file from Pivotal Network.

1. Navigate to the Ops Manager Installation Dashboard and click `Import a Product` to upload the product file. 

1. Under the `Import a Product` button, click `+` next to the version number of `SMB Volume Service`. This adds the tile to your staging area.

1. Click the newly added `SMB Volume Service` tile.

1. `Assign Networks`

  1. Please assign a network for `SMB Volume Service` to use. _Network `Deployment` is recommended._

  1. Click `Save`.

1. `Service Broker Application`:

  1. Configure `Log Level`: Please select `Log Level` by your demand, allowed values includes `error`, `warn`, `info` and `debug`.

  1. Configure `Share Environment`:

    <p class="note"><strong>Note</strong>: This setting will be frozen after first deployment. </p>

    1. To configure the broker to use preexisting SMB shares only, select `Preexisting SMB shares`;

    <p class="note"><strong>Note</strong>: You can still create Azure file shares manually and use them as `Preexisting SMB shares` in this mode. </p>

    1. To allow the broker to use `Azure File Service`, select `Azure File Share`.

      1. For **Tenant ID**, enter the tenant id of your Azure service principal.

      1. For **Client ID**, enter the client id of your Azure service principal.

      1. For **Client Secret**, enter the client secret of your Azure service principal.

      1. For **Default Subsctiption ID**, enter the default Azure Subscription id to use for storage accounts.

      1. For **Default Resource Group Name**, enter the default resource group name to use for storage accounts.

      1. For **Default Location**, enter the location to use for creating storage accounts.

      1. Enable `Allow Create Storage Account` if you want to allow the broker to create storage account.

      1. Enable `Allow Create File Share` if you want to allow the broker to create Azure file share.

      1. Enable `Allow Delete Storage Account` if you want to allow the broker to deleet storage account.

      1. Enable `Allow Delete File Share` if you want to allow the broker to deleet Azure file share.

  1. Click `Save`.

1. `Service Broker Database Config`:

  1. For `Database Driver`, please select type of database you wish to use to store broker''s state between `MsSQL` and `MySQL`.

  1. (Optional) For `Database CACert`, enter the content of CA Cert to verify SSL connection.

  1. (Optional) For `Host Name in Certificate`, enter the Common Name (CN) in the server certificate.
     Enter one of below values to enable TLS encryption when using Azure SQL service, or Azure MySQL service.
      - For AzureCloud: *.database.windows.net
      - For AzureUSGovernment: *.database.usgovcloudapi.net
      - For AzureChinaCloud: *.database.chinacloudapi.cn
      - For AzureGermanCloud: *.database.cloudapi.de

  <p class="note"><strong>Note</strong>: If either `Database CACert` or `Host Name in Certificate` is set, connections to database will be forced to use SSL </p>

  1. Configure `Database Type`:

  <p class="note"><strong>Note</strong>: This setting will be frozen after first deployment. </p>

    1. To use database service provided by another service broker, please select `Cloud Foundry Service`.
       For `Cloud Foundry Service Name`, enter the service name in VCAP_SERVICES where broker should find database credentials. It must be set to the service name for the database service as seen in `cf marketplace` which you want to bind to this broker. If you want to use an Azure SQL service, please reference this [guidance](https://github.com/cloudfoundry/smb-volume-release#way-1-cf-push-the-broker).

    1. To use existing database service, please select `Existing External Database`.

      1. For `Database Hostname`, enter the hostname for the database.

      1. For `Database Port`, enter the port for the database.

      1. For `Database Name`, enter the name for the database.

      1. For `Database Username`, enter the username for the database.

      1. For `Database Password`, enter the password for the database.

  1. Click `Save`.

1. `Service Broker Bind Config`:

  1. For `Allowed Options`, enter a comma separated list of parameters allowed to be set in during bind operations.
     Except `share`, and `mount`, others parameters here must also be in the list of `Mount Flag Allowed` in `SMB Driver Config`.

  1. For `Default Options`, enter a comma separated list of default parameter values specified as `param:value`. 
  
  <p class="note"><strong>Note</strong>: If a parameter has a default value, while it is not in the `Allowed Options` list, then its default value becomes a fixed value that cannot be overridden.</p>

  1. Click `Save`.

1. `SMB Driver Config`:

  1. For `Mount Flag Allowed`, enter a comma separted list of parameters allowed to be send in extra config. Each of this parameters can be specify by brokers.

  1. For `Mount Flag Default`, enter a comma separted list of like params:value. This list specifies default value of parameters.

  1. Click `Save`.

1. `Service Access`

  1. Enable `Enable Global access to all Services and Plans` if you want all orgs and spaces to be allowed to access service plans provided by this broker;

  1. Click `Save`.

1. Return to the `Ops Manager` Installation Dashboard and click `Apply changes` to install SMB Volume Service tile.
